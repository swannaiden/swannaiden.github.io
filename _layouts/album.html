<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ page.title }}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link href="{{ '/assets/css/photography.css' | relative_url }}" rel="stylesheet" />
    <link rel="stylesheet" href="https://unpkg.com/photoswipe@5/dist/photoswipe.css" />
  </head>
  <body>
    <header class="ph-header">
      <nav class="ph-nav">
        <a class="ph-home" href="{{ '/photography/' | relative_url }}">back</a>
      </nav>
    </header>

    <main class="ph-container">
      <article class="album">
        <h1 class="ph-title">{{ page.title }}</h1>
        {% if page.description %}
        <p class="ph-description">{{ page.description }}</p>
        {% endif %}

        {% assign dir = page.images_dir | default: '' %}
        {% assign files = site.static_files | where_exp: 'file', 'file.path contains dir' %}
        <div id="gallery" class="pswp-gallery ph-grid">
          {% for file in files %}
            {% assign ext = file.extname | downcase %}
            {% if ext == '.jpg' or ext == '.jpeg' or ext == '.png' or ext == '.gif' or ext == '.webp' %}
              <a href="{{ file.path | relative_url }}" target="_blank" rel="noreferrer" class="ph-thumb" data-pswp-width="1" data-pswp-height="1">
                <img src="{{ file.path | relative_url }}" alt="{{ page.title }} photo {{ forloop.index }}" loading="lazy" />
              </a>
            {% endif %}
          {% endfor %}
        </div>
      </article>
    </main>

    <footer class="ph-footer">
      <div class="ph-container">
        <small>&copy; {{ site.time | date: '%Y' }} Aiden Swann</small>
      </div>
    </footer>

    <script type="module">
      const anchors = Array.from(document.querySelectorAll('#gallery a'));
      const preload = (a) => new Promise((resolve) => {
        const img = new Image();
        img.onload = () => {
          a.dataset.pswpWidth = img.naturalWidth || 1;
          a.dataset.pswpHeight = img.naturalHeight || 1;
          resolve();
        };
        img.onerror = resolve;
        img.src = a.getAttribute('href');
      });

      Promise.all(anchors.map(preload)).then(() => {
        import('https://unpkg.com/photoswipe@5/dist/photoswipe-lightbox.esm.js').then(({ default: PhotoSwipeLightbox }) => {
          const lightbox = new PhotoSwipeLightbox({
            gallery: '#gallery',
            children: 'a',
            pswpModule: () => import('https://unpkg.com/photoswipe@5/dist/photoswipe.esm.js')
          });
          lightbox.init();
        });
      });
    </script>
  </body>
</html> 