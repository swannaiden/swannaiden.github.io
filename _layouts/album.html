<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ page.title }}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link href="{{ '/assets/css/photography.css' | relative_url }}" rel="stylesheet" />
    <link rel="stylesheet" href="https://unpkg.com/photoswipe@5/dist/photoswipe.css" />
  </head>
  <body>
    <header class="ph-header">
      <nav class="ph-nav">
        <a class="ph-home" href="{{ '/photography/' | relative_url }}">back</a>
      </nav>
    </header>

    <main class="ph-container">
      <article class="album">
        <h1 class="ph-title">{{ page.title }}</h1>
        {% if page.description %}
        <p class="ph-description">{{ page.description }}</p>
        {% endif %}

        {% assign dir = page.images_dir | default: '' %}
        {% assign files = site.static_files | where_exp: 'file', 'file.path contains dir' %}
        {% assign album_slug = page.title | downcase | replace: ' ', '-' | replace_regex: '[^a-z0-9\-]', '' %}
        {% assign sizes = site.data.album_sizes[album_slug] %}
        <div id="gallery" class="pswp-gallery ph-grid">
          {% for file in files %}
            {% unless file.path contains '/thumbs/' %}
              {% assign ext = file.extname | downcase %}
              {% if ext == '.jpg' or ext == '.jpeg' or ext == '.png' or ext == '.gif' or ext == '.webp' %}
                {% comment %}Optional filename prefix filtering{% endcomment %}
                {% assign include_file = 1 %}
                {% if page.filename_prefixes %}
                  {% assign include_file = 0 %}
                  {% for p in page.filename_prefixes %}
                    {% assign l = p | size %}
                    {% assign prefix = file.name | slice: 0, l %}
                    {% if prefix == p %}
                      {% assign include_file = 1 %}
                    {% endif %}
                  {% endfor %}
                {% endif %}
                {% if include_file == 1 %}
                  {% assign filename = file.name %}
                  {% assign dims = sizes[filename] %}
                  {% assign w = dims.width | default: 0 %}
                  {% assign h = dims.height | default: 0 %}
                  {% assign thumb_name = filename | split: '.' | first | append: '.webp' %}
                  {% assign thumb_url = dir | append: 'thumbs/' | append: thumb_name %}
                  <a href="{{ file.path | relative_url }}" target="_blank" rel="noreferrer" class="ph-thumb" {% if w > 0 and h > 0 %}data-pswp-width="{{ w }}" data-pswp-height="{{ h }}"{% endif %}>
                    <img src="{{ thumb_url | relative_url }}" alt="{{ page.title }} photo {{ forloop.index }}" loading="lazy" decoding="async" />
                  </a>
                {% endif %}
              {% endif %}
            {% endunless %}
          {% endfor %}
        </div>
      </article>
    </main>

    <footer class="ph-footer">
      <div class="ph-container">
        <small>&copy; {{ site.time | date: '%Y' }} Aiden Swann</small>
      </div>
    </footer>

    <script type="module">
      import('https://unpkg.com/photoswipe@5/dist/photoswipe-lightbox.esm.js').then(({ default: PhotoSwipeLightbox }) => {
        const lightbox = new PhotoSwipeLightbox({
          gallery: '#gallery',
          children: 'a',
          pswpModule: () => import('https://unpkg.com/photoswipe@5/dist/photoswipe.esm.js')
        });
        lightbox.init();
      });
    </script>
  </body>
</html> 